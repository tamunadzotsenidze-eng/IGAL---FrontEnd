<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IGAL Widget Production Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .test-container {
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    h1 {
      color: #1f2937;
      margin-bottom: 10px;
    }

    .status {
      background: #10b981;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      margin: 20px 0;
      font-weight: 500;
    }

    .info {
      background: #f3f4f6;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      border-left: 4px solid #2563eb;
    }

    .example-questions {
      margin: 20px 0;
    }

    .example-questions h3 {
      color: #374151;
      margin-bottom: 12px;
    }

    .example-questions ul {
      list-style: none;
      padding: 0;
    }

    .example-questions li {
      background: #eff6ff;
      padding: 12px 16px;
      margin: 8px 0;
      border-radius: 6px;
      color: #1e40af;
      cursor: pointer;
      transition: all 0.2s;
    }

    .example-questions li:hover {
      background: #dbeafe;
      transform: translateX(4px);
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>ğŸ¯ IGAL Production Widget Test</h1>
    <p style="color: #6b7280; font-size: 18px;">
      áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒáƒ¡ áƒ¡áƒáƒ’áƒáƒ“áƒáƒ¡áƒáƒ®áƒáƒ“áƒ áƒ™áƒáƒœáƒáƒœáƒ›áƒ“áƒ”áƒ‘áƒšáƒáƒ‘áƒ˜áƒ¡ AI áƒ™áƒáƒœáƒ¡áƒ£áƒšáƒ¢áƒáƒœáƒ¢áƒ˜
    </p>

    <div class="status">
      âœ… Production Ready - 12,815 Embeddings - 143 Documents
    </div>

    <div class="info">
      <strong>Backend URL:</strong> https://igal-backend-613144374930.europe-west3.run.app<br>
      <strong>Database:</strong> Cloud SQL (Production)<br>
      <strong>Model:</strong> text-embedding-3-small + GPT-4
    </div>

    <div class="example-questions">
      <h3>ğŸ“ Example Questions (Click to Test):</h3>
      <ul>
        <li onclick="testQuestion(this)">áƒ áƒ áƒáƒ áƒ˜áƒ¡ áƒ“áƒ¦áƒ’?</li>
        <li onclick="testQuestion(this)">áƒ áƒáƒ’áƒáƒ  áƒ’áƒáƒ“áƒáƒ•áƒ˜áƒ®áƒáƒ“áƒ áƒ’áƒáƒ“áƒáƒ¡áƒáƒ®áƒáƒ“áƒ˜?</li>
        <li onclick="testQuestion(this)">áƒ¡áƒáƒ“ áƒ¨áƒ”áƒ›áƒ˜áƒ«áƒšáƒ˜áƒ áƒ“áƒ”áƒ™áƒšáƒáƒ áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ¨áƒ”áƒ•áƒ¡áƒ”áƒ‘áƒ?</li>
        <li onclick="testQuestion(this)">áƒ áƒ áƒáƒ áƒ˜áƒ¡ áƒ¡áƒáƒ¨áƒ”áƒ›áƒáƒ¡áƒáƒ•áƒšáƒ áƒ’áƒáƒ“áƒáƒ¡áƒáƒ®áƒáƒ“áƒ˜?</li>
        <li onclick="testQuestion(this)">áƒ áƒáƒ’áƒáƒ  áƒ“áƒáƒ•áƒáƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ“áƒ” áƒ’áƒáƒ“áƒáƒ¡áƒáƒ®áƒáƒ“áƒ˜áƒ¡ áƒ’áƒáƒ“áƒáƒ›áƒ®áƒ“áƒ”áƒšáƒáƒ“?</li>
      </ul>
    </div>

    <p style="color: #6b7280; margin-top: 40px;">
      ğŸ‘‰ Click the widget in the bottom-right corner to start testing!
    </p>
  </div>

  <!-- IGAL Chat Widget -->
  <div id="igal-chat-widget"></div>

  <script>
    // Widget Configuration
    const IGAL_CONFIG = {
      backendUrl: 'https://igal-backend-613144374930.europe-west3.run.app',
      widgetEndpoint: '/api/chat/widget/',
      position: 'bottom-right',
      primaryColor: '#2563eb',
      title: 'áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒáƒ¡ áƒ¡áƒáƒ’áƒáƒ“áƒáƒ¡áƒáƒ®áƒáƒ“áƒ áƒ™áƒáƒœáƒ¡áƒ£áƒšáƒ¢áƒáƒœáƒ¢áƒ˜'
    };

    // Create widget container
    const widgetHTML = `
      <style>
        #igal-widget-container {
          position: fixed;
          bottom: 20px;
          right: 20px;
          width: 400px;
          max-width: 90vw;
          height: 600px;
          max-height: 80vh;
          background: white;
          border-radius: 12px;
          box-shadow: 0 8px 32px rgba(0,0,0,0.2);
          display: flex;
          flex-direction: column;
          z-index: 9999;
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
          animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
          from {
            transform: translateY(100%);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }

        #igal-widget-header {
          background: ${IGAL_CONFIG.primaryColor};
          color: white;
          padding: 16px;
          border-radius: 12px 12px 0 0;
          font-weight: 600;
          font-size: 16px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        #igal-widget-messages {
          flex: 1;
          overflow-y: auto;
          padding: 16px;
          background: #f9fafb;
        }

        .igal-message {
          margin-bottom: 12px;
          padding: 12px 16px;
          border-radius: 8px;
          max-width: 85%;
          line-height: 1.5;
          font-size: 14px;
          animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }

        .igal-message.user {
          background: ${IGAL_CONFIG.primaryColor};
          color: white;
          margin-left: auto;
        }

        .igal-message.assistant {
          background: white;
          color: #1f2937;
          border: 1px solid #e5e7eb;
        }

        #igal-widget-input-container {
          padding: 16px;
          border-top: 1px solid #e5e7eb;
          background: white;
          border-radius: 0 0 12px 12px;
          display: flex;
          gap: 8px;
        }

        #igal-widget-input {
          flex: 1;
          padding: 10px 14px;
          border: 1px solid #d1d5db;
          border-radius: 8px;
          font-size: 14px;
          outline: none;
          font-family: inherit;
        }

        #igal-widget-input:focus {
          border-color: ${IGAL_CONFIG.primaryColor};
          box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        #igal-widget-send {
          padding: 10px 20px;
          background: ${IGAL_CONFIG.primaryColor};
          color: white;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.2s;
        }

        #igal-widget-send:hover {
          opacity: 0.9;
          transform: translateY(-1px);
        }

        #igal-widget-send:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .igal-loading {
          color: #6b7280;
          font-style: italic;
        }

        .igal-loading::after {
          content: '...';
          animation: dots 1.5s infinite;
        }

        @keyframes dots {
          0%, 20% { content: '.'; }
          40% { content: '..'; }
          60%, 100% { content: '...'; }
        }

        .igal-sources {
          font-size: 12px;
          color: #6b7280;
          margin-top: 8px;
          padding-top: 8px;
          border-top: 1px solid #e5e7eb;
        }
      </style>

      <div id="igal-widget-container">
        <div id="igal-widget-header">
          ${IGAL_CONFIG.title}
          <span style="font-size: 12px; opacity: 0.9;">ğŸŸ¢ Live</span>
        </div>
        <div id="igal-widget-messages">
          <div class="igal-message assistant">
            áƒ’áƒáƒ›áƒáƒ áƒ¯áƒáƒ‘áƒ! ğŸ‘‹<br><br>
            áƒ›áƒ” áƒ•áƒáƒ  áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒáƒ¡ áƒ¡áƒáƒ’áƒáƒ“áƒáƒ¡áƒáƒ®áƒáƒ“áƒ áƒ™áƒáƒœáƒáƒœáƒ›áƒ“áƒ”áƒ‘áƒšáƒáƒ‘áƒ˜áƒ¡ AI áƒ™áƒáƒœáƒ¡áƒ£áƒšáƒ¢áƒáƒœáƒ¢áƒ˜.
            áƒ›áƒ” áƒ›áƒáƒ¥áƒ•áƒ¡ áƒ¬áƒ•áƒ“áƒáƒ›áƒ 143 áƒ¡áƒáƒ›áƒáƒ áƒ—áƒšáƒ”áƒ‘áƒ áƒ˜áƒ• áƒ“áƒáƒ™áƒ£áƒ›áƒ”áƒœáƒ¢áƒ–áƒ” áƒ“áƒ 12,815+ áƒ™áƒáƒœáƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ–áƒ”.<br><br>
            áƒ áƒ˜áƒ— áƒ¨áƒ”áƒ›áƒ˜áƒ«áƒšáƒ˜áƒ áƒ“áƒáƒ’áƒ”áƒ®áƒ›áƒáƒ áƒáƒ—?
          </div>
        </div>
        <div id="igal-widget-input-container">
          <input
            type="text"
            id="igal-widget-input"
            placeholder="áƒ“áƒáƒ¡áƒ•áƒ˜áƒ— áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ..."
            onkeypress="if(event.key==='Enter') sendMessage()"
          />
          <button id="igal-widget-send" onclick="sendMessage()">ğŸ“¤</button>
        </div>
      </div>
    `;

    document.getElementById('igal-chat-widget').innerHTML = widgetHTML;

    // Send message function
    async function sendMessage() {
      const input = document.getElementById('igal-widget-input');
      const messagesDiv = document.getElementById('igal-widget-messages');
      const sendBtn = document.getElementById('igal-widget-send');

      const message = input.value.trim();
      if (!message) return;

      // Add user message
      const userMsg = document.createElement('div');
      userMsg.className = 'igal-message user';
      userMsg.textContent = message;
      messagesDiv.appendChild(userMsg);

      // Clear input and disable button
      input.value = '';
      sendBtn.disabled = true;

      // Add loading indicator
      const loadingMsg = document.createElement('div');
      loadingMsg.className = 'igal-message assistant igal-loading';
      loadingMsg.textContent = 'áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ';
      messagesDiv.appendChild(loadingMsg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;

      try {
        console.log('Sending to:', IGAL_CONFIG.backendUrl + IGAL_CONFIG.widgetEndpoint);
        console.log('Message:', message);

        // Call production backend
        const response = await fetch(IGAL_CONFIG.backendUrl + IGAL_CONFIG.widgetEndpoint, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ message: message })
        });

        console.log('Response status:', response.status);

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        console.log('Response data:', data);

        // Remove loading
        messagesDiv.removeChild(loadingMsg);

        // Add assistant response
        const assistantMsg = document.createElement('div');
        assistantMsg.className = 'igal-message assistant';

        const responseText = data.response || data.message || data.answer || 'áƒáƒáƒ¡áƒ£áƒ®áƒ˜ áƒáƒ  áƒ›áƒ˜áƒ•áƒ˜áƒ¦áƒ”áƒ—';
        assistantMsg.innerHTML = responseText;

        // Add sources if available
        if (data.sources && data.sources.length > 0) {
          const sources = document.createElement('div');
          sources.className = 'igal-sources';
          sources.innerHTML = `ğŸ“š áƒ¬áƒ§áƒáƒ áƒáƒ”áƒ‘áƒ˜: ${data.sources.slice(0, 3).map(s => s.title || s.document_title).join(', ')}`;
          assistantMsg.appendChild(sources);
        }

        messagesDiv.appendChild(assistantMsg);

      } catch (error) {
        console.error('Error:', error);

        // Remove loading
        if (loadingMsg.parentNode) {
          messagesDiv.removeChild(loadingMsg);
        }

        // Show error
        const errorMsg = document.createElement('div');
        errorMsg.className = 'igal-message assistant';
        errorMsg.innerHTML = `âŒ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: ${error.message}<br><br>
          <small>áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¨áƒ”áƒáƒ›áƒáƒ¬áƒ›áƒáƒ— áƒ™áƒáƒœáƒ¡áƒáƒšáƒ˜ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ—áƒ˜ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡ (F12 â†’ Console)</small>`;
        messagesDiv.appendChild(errorMsg);
      }

      // Re-enable button and scroll
      sendBtn.disabled = false;
      input.focus();
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    // Test question helper
    function testQuestion(element) {
      const question = element.textContent;
      const input = document.getElementById('igal-widget-input');
      input.value = question;
      input.focus();

      // Optionally auto-send
      setTimeout(() => sendMessage(), 300);
    }

    console.log('ğŸ¯ IGAL Widget Loaded');
    console.log('Backend:', IGAL_CONFIG.backendUrl);
    console.log('Endpoint:', IGAL_CONFIG.widgetEndpoint);
  </script>
</body>
</html>
